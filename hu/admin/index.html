async function saveTemplateWeek(){
  try{
    const planId = ($("#p_planId").value || "").trim();
    const weekNo = clamp(parseInt($("#p_weekNo").value || "1", 10), 1, 24);
    if(!planId) return err("Plan ID üres.");

    const workoutsRaw = parseJson($("#t_workouts").value, []);
    const slots = parseJson($("#t_slots").value, []);
    if(!Array.isArray(workoutsRaw)) throw new Error("Template workouts: JSON tömb kell.");
    if(!Array.isArray(slots)) throw new Error("Template slots: JSON tömb kell.");

    // ✅ NORMALIZÁLÁS: vimeoid/video/url -> vimeoId
    const workouts = workoutsRaw.map(w=>{
      const v = (w?.vimeoId ?? "") || (w?.vimeoid ?? "") || (w?.video ?? "") || (w?.url ?? "");
      const ww = { ...w };
      ww.vimeoId = String(v || "").trim();
      delete ww.vimeoid;
      delete ww.video;
      delete ww.url;
      return ww;
    });

    await fs.setDoc(fs.doc(db, "planTemplates", planId, "weeks", String(weekNo)), {
      weekNo,
      workouts,
      slots,
      updatedAt: fs.serverTimestamp()
    }, { merge:true });

    ok("Template week mentve (vimeoId standard)");
  }catch(e){
    console.error(e);
    err(e.message || String(e));
  }
}
