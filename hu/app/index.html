<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitness Lady — Saját programom</title>
  <style>
    :root{ --bg:#07060b; --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.70); --pink:#ff4fd8; --radius:22px; --max:1180px; }
    *{ box-sizing:border-box; }
    html,body{ height:100%; scroll-behavior:smooth; }
    body{ margin:0; font-family:ui-sans-serif,system-ui,sans-serif; color:var(--text); background:radial-gradient(1200px 700px at 20% 10%, rgba(255,79,216,.10), transparent 60%), var(--bg); background-attachment:fixed; }
    .container{ width:min(var(--max), 92vw); margin:0 auto; padding-top:80px; }
    .topbar{ position:fixed; top:0; left:0; right:0; z-index:50; background:rgba(8,6,12,.75); border-bottom:1px solid rgba(255,255,255,.06); backdrop-filter:blur(12px); }
    .topbar-inner{ height:64px; display:flex; align-items:center; justify-content:space-between; padding:0 4%; }
    .glass{ background:rgba(18,12,26,0.55); border:1px solid rgba(255,255,255,0.08); border-radius:22px; padding:18px; margin-bottom:14px; backdrop-filter:blur(10px); }
    h2{ font-family:serif; font-size:26px; margin:0 0 10px; }
    .meal-card{ padding:16px; background:rgba(0,0,0,0.2); border-radius:18px; border:1px solid rgba(255,255,255,0.05); margin-bottom:12px; }
    .label{ font-size:11px; font-weight:900; color:var(--pink); text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; }
    .row{ display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; padding:12px; border-radius:16px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,0.06); margin-bottom:10px; }
    .pill{ padding:8px 14px; border-radius:999px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.1); color:#fff; cursor:pointer; font-size:12px; }
    .progress{ background:rgba(0,0,0,.4); border-radius:999px; height:10px; overflow:hidden; margin-top:5px; }
    .progress span{ display:block; height:100%; background:var(--pink); width:0; transition:width 0.3s; }
    .modal-overlay{ position:fixed; inset:0; z-index:80; background:rgba(0,0,0,.7); backdrop-filter:blur(8px); display:none; align-items:center; justify-content:center; padding:18px; }
    .modal-overlay.is-open{ display:flex; }
    .modal{ width:min(980px, 94vw); border-radius:22px; overflow:hidden; background:#0a080f; }
    .modal-header{ display:flex; justify-content:space-between; padding:14px; border-bottom:1px solid rgba(255,255,255,.08); }
  </style>
</head>
<body>
  <header class="topbar"><div class="topbar-inner"><div style="font-weight:800;">Fitness Lady</div><button class="pill" id="btnLogout">Kilépés</button></div></header>
  <main class="container">
    <section class="glass"><h2 id="greetingHeader">Szia!</h2><div id="subStatus">Betöltés...</div></section>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">
      <section class="glass"><div id="intro-container"></div><h3>Heti edzések</h3><div class="tabs" id="weekTabs"></div><ul class="list" id="workoutList"></ul></section>
      <section class="glass"><h3>Napi Étrend</h3><div class="tabs" id="dietDays"></div><div id="dietDetails"></div>
        <hr style="opacity:.1; margin:15px 0;"><h3>Célok</h3><div>Víz <div class="progress"><span id="waterBar"></span></div><button class="pill" id="addWater" style="margin-top:10px;">+1</button></div>
        <div style="margin-top:10px; padding:12px; background:rgba(255,79,216,.1); border-radius:14px;"><strong id="motTitle"></strong><p id="motBox" style="font-size:13px;"></p></div></section>
    </div>
    <section class="glass"><h3>Technika Vault</h3><ul class="list" id="techList"></ul></section>
  </main>
  <div class="modal-overlay" id="infoOverlay"><div class="modal"><div class="modal-header"><h3 id="infoTitle"></h3><button class="pill" onclick="$('#infoOverlay').classList.remove('is-open')">✕</button></div><div id="infoBody" style="padding:20px;"></div></div></div>
  <script type="module">
    import { db, fs, onAuth, logout, toLogin, escapeHtml, safeJsonParse } from "../shared/firebase.js";
    const $ = s => document.querySelector(s);
    let UID = null; let profile = null; let planMeta = null;
    const state = { weekIdx: 0, selectedDay: "mon", water: 0 };
    const DAYS = [{id:"mon",name:"Hé"},{id:"tue",name:"Ke"},{id:"wed",name:"Sze"},{id:"thu",name:"Cs"},{id:"fri",name:"Pé"},{id:"sat",name:"Szo"},{id:"sun",name:"Va"}];
    function getAiGreeting(name){ const h = new Date().getHours(); const n = name ? `, ${name}` : ""; if(h<10) return `Jó reggelt${n}!`; if(h<18) return `Szia${n}!`; return `Szép estét${n}!`; }
    async function loadVault(){
      const snap = await fs.getDoc(fs.doc(db, "settings", "vault"));
      const items = snap.data()?.items || [];
      $("#techList").innerHTML = items.map(v => `<li class="row" onclick="window.openText('${escapeHtml(v.title)}','${escapeHtml(v.desc)}')"><div class="title">${v.title}</div><button class="pill tiny">Megnyitás</button></li>`).join("");
    }
    window.openText = (t, d) => { $("#infoTitle").textContent = t; $("#infoBody").innerHTML = `<div style="white-space:pre-wrap;">${d}</div>`; $("#infoOverlay").classList.add("is-open"); };
    function renderIntro(){ if(state.weekIdx===0 && planMeta?.introVideo){ $("#intro-container").innerHTML = `<div class="box" style="background:rgba(255,211,138,.1); padding:15px; border-radius:18px; margin-bottom:15px;"><h3>Ismerj meg</h3><button class="pill primary" onclick="window.openVideo('${planMeta.introVideo}')">Megtekintés</button></div>`; } else { $("#intro-container").innerHTML = ""; } }
    window.openVideo = (id) => { $("#infoTitle").textContent="Bemutatkozás"; $("#infoBody").innerHTML=`<iframe src="https://player.vimeo.com/video/${id}" width="100%" height="400" frameborder="0" allowfullscreen></iframe>`; $("#infoOverlay").classList.add("is-open"); };
    function renderDiet(){
      const day = profile?.dietPlan?.[`w${state.weekIdx+1}`]?.[state.selectedDay] || {};
      $("#dietDetails").innerHTML = `<div class="meal-card"><div class="label">EBÉD</div><div>${day.lunch || "Nincs megadva"}</div></div>`;
      $("#dietDays").innerHTML = DAYS.map(d => `<button class="pill ${state.selectedDay===d.id?'primary':''}" onclick="window.setDay('${d.id}')">${d.name}</button>`).join(" ");
    }
    window.setDay = (id) => { state.selectedDay=id; renderDiet(); };
    onAuth(async u => {
      if(!u) return toLogin("hu"); UID = u.uid;
      const snap = await fs.getDoc(fs.doc(db, "users", UID));
      profile = snap.data() || {};
      const mSnap = await fs.getDoc(fs.doc(db, "planTemplates", profile.planId || "start_v1"));
      planMeta = mSnap.data() || {};
      $("#greetingHeader").textContent = getAiGreeting(profile.firstName);
      $("#subStatus").textContent = "Program aktív";
      $("#motTitle").textContent = profile.motivationCard?.title || "";
      $("#motBox").textContent = profile.motivationCard?.text || "";
      renderDiet(); renderIntro(); await loadVault();
    });
    $("#addWater").onclick = () => { state.water = Math.min(8, state.water+1); $("#waterBar").style.width = (state.water/8*100)+"%"; };
    $("#btnLogout").onclick = async () => { await logout(); toLogin("hu"); };
  </script>
</body>
</html>
