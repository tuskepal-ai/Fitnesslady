<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitness Lady ‚Äî Saj√°t programom</title>
  <style>
    :root{
      --bg:#07060b;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --pink:#ff4fd8;
      --pink2:#b14cff;
      --radius:22px;
      --max:1180px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; scroll-behavior: smooth; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      overflow-x:hidden;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(255,79,216,.10), transparent 60%), var(--bg);
      background-attachment: fixed;
    }
    a{ color:inherit; text-decoration:none; }
    button{ font:inherit; }
    .container{ width: min(var(--max), 92vw); margin: 0 auto; }
    .topbar{
      position: fixed; top:0; left:0; right:0; z-index: 50;
      background: rgba(8,6,12,.75); border-bottom: 1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    }
    .topbar-inner{ height: 64px; display:flex; align-items:center; justify-content: space-between; padding: 0 4%; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; }
    .dot{ width:10px;height:10px;border-radius:999px; background: var(--pink); box-shadow: 0 0 18px rgba(255,79,216,.7); }
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 9px 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,.12);
      background: rgba(20,12,26,.65); color: var(--text); cursor:pointer; gap:8px;
    }
    .pill.primary{ background: linear-gradient(135deg, var(--pink), var(--pink2)); color:#140813; font-weight: 900; border:none; }
    .pill.ghost{ background: rgba(255,255,255,.06); }
    main{ padding-top: 80px; }
    .glass{
      background: rgba(18, 12, 26, 0.55); border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 22px; padding: 18px; margin-bottom: 14px; backdrop-filter: blur(10px);
    }
    .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap: 14px; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }
    h2, h3{ margin:0 0 6px; font-family: ui-serif, Georgia, serif; }
    .sub{ color: var(--muted); font-size: 13.5px; }
    .progress{ background: rgba(0,0,0,.4); border-radius: 999px; height: 12px; overflow:hidden; margin: 10px 0; }
    .progress span{ display:block; height:100%; background: var(--pink); width: 0%; transition: width .4s ease; }
    .tabs{ display:flex; flex-wrap:wrap; gap: 8px; margin: 8px 0 14px; }
    .tab{ padding: 8px 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.05); color: rgba(255,255,255,.85); cursor:pointer; font-weight: 800; }
    .tab.is-active{ background: linear-gradient(135deg, var(--pink), var(--pink2)); color:#140813; }
    .row{ display:grid; grid-template-columns: 1fr auto; gap: 10px; align-items:center; padding: 12px; border-radius: 16px; background: rgba(0,0,0,.25); border: 1px solid rgba(255,255,255,.06); margin-bottom: 10px; }
    .modal-overlay{ position: fixed; inset: 0; z-index: 80; background: rgba(0,0,0,.7); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; padding: 18px; }
    .modal-overlay.is-open{ display:flex; }
    .modal{ width: min(980px, 94vw); border-radius: 22px; background: #0a080f; overflow: hidden; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand"><span class="dot"></span><span>Fitness Lady</span></div>
      <button class="pill ghost" id="btnLogout">‚éã Kil√©p√©s</button>
    </div>
  </header>

  <main class="container">
    <section class="glass">
      <h2 id="greetingHeader">Szia!</h2>
      <p class="sub" id="subStatus">Bet√∂lt√©s...</p>
    </section>

    <div class="grid">
      <section class="glass">
        <div id="intro-container"></div>
        <h3>Heti edz√©sek</h3>
        <div class="tabs" id="weekTabs"></div>
        <ul class="list" id="workoutList" style="list-style:none; padding:0;"></ul>
        <hr style="opacity:.1; margin:20px 0;">
        <h3>Szem√©lyre szab√°s</h3>
        <ul class="list" id="slotList" style="list-style:none; padding:0;"></ul>
      </section>

      <div style="display:grid; gap:14px;">
        <section class="glass">
          <h3>Napi √âtrend</h3>
          <div class="tabs" id="dietDays"></div>
          <div id="dietDetails"></div>
        </section>
        <section class="glass">
          <h3>Napi C√©lok</h3>
          <div>V√≠z <div class="progress"><span id="barWater"></span></div><button class="pill ghost tiny" id="btnAddWater">+1 Poh√°r</button></div>
          <div style="margin-top:15px; padding:16px; background:rgba(255,79,216,.1); border-radius:18px;">
            <strong id="motTitle"></strong><p id="motBox" style="font-size:13px;"></p>
          </div>
        </section>
      </div>
    </div>
    <section class="glass">
      <h3>Technika Vault</h3>
      <ul class="list" id="techList" style="list-style:none; padding:0;"></ul>
    </section>
  </main>

  <div class="modal-overlay" id="infoOverlay"><div class="modal"><div id="infoBody" style="padding:20px;"></div><button class="pill" style="margin:10px;" onclick="$('#infoOverlay').classList.remove('is-open')">Bez√°r√°s</button></div></div>

  <script type="module">
    import { db, fs, onAuth, logout, toLogin, escapeHtml, safeJsonParse } from "../shared/firebase.js";
    const $ = s => document.querySelector(s);
    let UID = null; let profile = null;

    // üî• FEJLESZT√âS: AI √úDV√ñZL√âS üî•
    function getAiGreeting(name){
      const h = new Date().getHours(); const n = name ? `, ${name}` : "";
      if(h<10) return `J√≥ reggelt${n}!`; if(h<18) return `Szia${n}!`; return `Sz√©p est√©t${n}!`;
    }

    async function loadVault(){
      try {
        const snap = await fs.getDoc(fs.doc(db, "settings", "vault"));
        const items = snap.data()?.items || [];
        $("#techList").innerHTML = items.map(v => `<li class="row" onclick="window.openTextVault('${escapeHtml(v.title)}','${escapeHtml(v.desc)}')"><div class="title">${v.title}</div><button class="pill ghost tiny">Megnyit√°s</button></li>`).join("");
      } catch (e) { console.error(e); }
    }
    window.openTextVault = (t,d) => { $("#infoBody").innerHTML = `<h3>${t}</h3><div style="white-space:pre-wrap; line-height:1.6;">${d}</div>`; $("#infoOverlay").classList.add("is-open"); };

    onAuth(async u => {
      if(!u) return toLogin("hu"); UID = u.uid;
      try {
        const snap = await fs.getDoc(fs.doc(db, "users", UID)); profile = snap.data() || {};
        $("#greetingHeader").textContent = getAiGreeting(profile.firstName);
        $("#subStatus").textContent = "Program akt√≠v";
        
        // üî• FEJLESZT√âS: H√âT 1 INTRO üî•
        if(profile.introVideo) {
          $("#intro-container").innerHTML = `<div class="glass" style="background:rgba(255,211,138,.05); border-color:rgba(255,211,138,.2);"><h3>Bemutatkoz√°s</h3><button class="pill primary tiny" onclick="window.openVid('${profile.introVideo}')">Megnyit√°s</button></div>`;
        }
        
        await loadVault();
        $("#motTitle").textContent = profile.motivationCard?.title || "";
        $("#motBox").textContent = profile.motivationCard?.text || "";
      } catch (e) { $("#subStatus").textContent = "Bet√∂lt√©si hiba."; }
    });
    window.openVid = (id) => { $("#infoBody").innerHTML=`<iframe src="https://player.vimeo.com/video/${id}" width="100%" height="400" frameborder="0" allowfullscreen></iframe>`; $("#infoOverlay").classList.add("is-open"); };
    $("#btnLogout").onclick = async () => { await logout(); toLogin("hu"); };
  </script>
</body>
</html>
