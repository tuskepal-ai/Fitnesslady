<!-- FILE: /hu/app/index.html -->
<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fitness Lady ‚Äî Saj√°t programom</title>
  <meta name="description" content="Fitness Lady ‚Äî Saj√°t programom: csomag, heti edz√©sek, szem√©lyre szab√°s slotok, √©trend, check-in/c√©l, technika vault." />

  <style>
    :root{
      --bg:#07060b;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --muted2:rgba(255,255,255,.55);

      --pink:#ff4fd8;
      --pink2:#b14cff;
      --gold:#ffd38a;

      --radius:22px;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --max: 1180px;

      --glassA: rgba(255,255,255,.06);
      --glassB: rgba(255,255,255,.02);
      --stroke: rgba(255,255,255,.10);

      --hero-url: none;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      overflow-x:hidden;

      /* ‚úÖ √öJ, PR√âMIUM APP H√ÅTT√âR (nem hero.png) */
      background:
        radial-gradient(900px 520px at 12% 16%, rgba(255,79,216,.22), transparent 62%),
        radial-gradient(860px 520px at 86% 20%, rgba(177,76,255,.18), transparent 64%),
        radial-gradient(900px 520px at 65% 92%, rgba(255,211,138,.10), transparent 60%),
        radial-gradient(1px 1px at 12% 22%, rgba(255,255,255,.10) 0, transparent 2px),
        radial-gradient(1px 1px at 72% 18%, rgba(255,255,255,.08) 0, transparent 2px),
        radial-gradient(1px 1px at 44% 56%, rgba(255,255,255,.08) 0, transparent 2px),
        radial-gradient(1px 1px at 22% 78%, rgba(255,255,255,.07) 0, transparent 2px),
        radial-gradient(1px 1px at 88% 72%, rgba(255,255,255,.07) 0, transparent 2px),
        linear-gradient(180deg, rgba(8,6,12,1), rgba(7,6,11,1));
      background-attachment: fixed;
    }

    /* finom ‚Äúfilm grain‚Äù */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -1;
      background-image:
        radial-gradient(circle at 20% 10%, rgba(255,79,216,.08), transparent 45%),
        radial-gradient(circle at 80% 22%, rgba(177,76,255,.06), transparent 50%),
        radial-gradient(circle at 55% 88%, rgba(255,211,138,.04), transparent 48%);
      opacity: .90;
      pointer-events:none;
      transform: translateZ(0);
      filter: saturate(1.05);
    }
    body::after{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events:none;
      opacity: .10;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    a{ color:inherit; text-decoration:none; }
    button{ font:inherit; }
    .container{ width: min(var(--max), 92vw); margin: 0 auto; }

    .topbar{
      position: fixed; top:0; left:0; right:0;
      z-index: 50;
      background: rgba(8,6,12,.55);
      border-bottom: 1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .topbar-inner{
      height: 64px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.2px; white-space: nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ffd0f6, var(--pink));
      box-shadow: 0 0 18px rgba(255,79,216,.7);
      flex: 0 0 auto;
    }
    .nav{
      display:flex; align-items:center; gap: 14px;
      color: var(--muted); font-size: 13.5px; font-weight: 700;
    }
    .nav a{ position: relative; padding: 10px 6px; opacity:.92; }
    .nav a:hover{ opacity:1; color: var(--text); }
    .nav a::after{
      content:"";
      position:absolute;
      left: 8px; right: 8px; bottom: 6px;
      height: 2px; border-radius: 99px;
      background: linear-gradient(90deg, rgba(255,215,140,0), rgba(255,215,140,.9), rgba(255,215,140,0));
      transform: scaleX(0);
      transform-origin: left;
      opacity: 0;
      transition: transform .28s ease, opacity .28s ease;
    }
    .nav a:hover::after, .nav a.is-active::after{ transform: scaleX(1); opacity: 1; }

    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(20,12,26,.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: var(--text);
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      cursor:pointer;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      user-select:none;
      white-space: nowrap;
      gap:8px;
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.20); }
    .pill.primary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#140813;
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 18px 46px rgba(255,79,216,.26);
      font-weight: 900;
    }
    .pill.ghost{ background: rgba(255,255,255,.06); }
    .pill.danger{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.14); }

    .menu-btn{
      width: 40px; height: 40px; border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      display:none;
      align-items:center; justify-content:center;
      cursor:pointer;
    }

    main{ padding-top: 64px; min-height: 100vh; min-height: 100dvh; }
    .page{ padding: 18px 0 64px; }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 22px;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .interactive{
      position: relative;
      overflow: hidden;
      transition: transform .30s cubic-bezier(.2,.8,.2,1), box-shadow .30s ease, border-color .30s ease;
      will-change: transform;
    }
    .interactive::before{
      content:"";
      position:absolute; inset:-3px;
      border-radius: inherit;
      background:
        radial-gradient(700px 240px at 12% 0%, rgba(255,79,216,.32), transparent 55%),
        radial-gradient(700px 260px at 90% 20%, rgba(177,76,255,.26), transparent 60%);
      opacity: 0;
      filter: blur(6px);
      transition: opacity .30s ease;
      pointer-events:none;
    }
    .interactive:hover,
    .interactive:focus-visible,
    .interactive.is-active{
      transform: translateY(-4px);
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 22px 70px rgba(0,0,0,.55);
    }
    .interactive:hover::before,
    .interactive:focus-visible::before,
    .interactive.is-active::before{ opacity: 1; }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .nav{ display:none; }
      .menu-btn{ display:inline-flex; }
    }

    .card{ padding: 16px; }
    .card h2, .card h3{
      margin:0 0 8px;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      letter-spacing: -.2px;
    }
    .card h2{ font-size: 22px; }
    .card h3{ font-size: 18px; }
    .sub{ margin:0 0 12px; color: rgba(255,255,255,.70); line-height: 1.55; font-size: 13.5px; }

    .meta-row{ display:flex; flex-wrap:wrap; gap: 10px; margin-top: 10px; color: rgba(255,255,255,.55); font-size: 12.8px; }
    .meta-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .progress{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      height: 12px;
      overflow:hidden;
      position:relative;
    }
    .progress > span{
      display:block;
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(255,79,216,.95), rgba(177,76,255,.90));
      border-radius: 999px;
      transition: width .35s ease;
    }
    .progress-label{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      font-size: 12.5px;
      color: rgba(255,255,255,.55);
      margin: 10px 0 8px;
    }

    .tabs{ display:flex; flex-wrap:wrap; gap: 8px; margin: 8px 0 12px; }
    .tab{
      padding: 8px 11px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
      cursor:pointer;
      font-size: 13px;
      font-weight: 850;
      user-select:none;
    }
    .tab.is-active{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#140813;
      border-color: rgba(255,255,255,.18);
    }

    .list{ margin:0; padding:0; list-style:none; display:grid; gap:10px; }
    .row{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
      padding: 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
    }
    .row .title{ font-weight: 900; letter-spacing:.2px; font-size: 13.5px; }
    .row .desc{ color: rgba(255,255,255,.70); font-size: 12.8px; margin-top: 4px; line-height: 1.45; }
    .row .actions{ display:flex; gap: 8px; justify-content:flex-end; flex-wrap:wrap; }
    .tiny{ padding: 8px 10px; font-size: 12.5px; border-radius: 999px; }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: rgba(255,255,255,.70);
      white-space: nowrap;
      font-weight: 850;
      font-size: 12px;
    }

    section{ scroll-margin-top: 82px; }

    .modal-overlay{
      position: fixed; inset: 0; z-index: 80;
      background: rgba(0,0,0,.58);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
    }
    .modal-overlay.is-open{ display:flex; }
    .modal{
      width: min(980px, 94vw);
      max-height: min(82vh, 760px);
      border-radius: 22px;
      overflow: hidden;
      position: relative;
    }
    .modal-header{
      display:flex; align-items:center; justify-content: space-between; gap: 10px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(10,8,14,.45);
    }
    .modal-title{
      margin:0;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      font-size: 20px;
      letter-spacing: -.2px;
    }
    .modal-close{
      width: 40px; height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.9);
      cursor: pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .modal-body{
      padding: 16px;
      overflow: auto;
      max-height: calc(min(82vh, 760px) - 64px);
      background: rgba(7,6,11,.38);
    }
    .note{ color: rgba(255,255,255,.55); font-size: 12.6px; line-height: 1.55; }

    /* ‚úÖ PROFIBB SZ√ñVEG ST√çLUS (√©trend + motiv√°ci√≥) */
    .proText{
      color: rgba(255,255,255,.86);
      line-height: 1.65;
      font-size: 13.5px;
    }
    .proText h4{
      margin: 0 0 8px;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      font-size: 15.5px;
      letter-spacing: -.2px;
      color: rgba(255,255,255,.92);
    }
    .proText p{ margin: 0 0 10px; color: rgba(255,255,255,.84); }
    .proText ul{
      margin: 8px 0 10px 18px;
      padding: 0;
      color: rgba(255,255,255,.84);
    }
    .proText li{ margin: 4px 0; }
    .proText .kv{
      display:grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      align-items: baseline;
      padding: 8px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      margin: 8px 0 10px;
    }
    .proText .k{ color: rgba(255,255,255,.72); font-weight: 850; }
    .proText .v{ color: rgba(255,255,255,.90); }

    .quote{
      position: relative;
      padding: 12px 12px 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.88);
    }
    .quote::before{
      content:"";
      position:absolute; left:0; top:0; bottom:0;
      width: 3px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,79,216,.95), rgba(177,76,255,.85));
      opacity:.9;
    }

    footer{
      padding: 18px 0 46px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(10,8,14,.55);
      backdrop-filter: blur(10px);
    }
    .footer-inner{
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
      color:rgba(255,255,255,.70); font-size:13px;
    }

    .debug{
      position: fixed;
      bottom: 10px;
      left: 10px;
      right: 10px;
      z-index: 90;
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 12px;
      color: rgba(255,255,255,.85);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      display:none;
      backdrop-filter: blur(10px);
    }
    .debug.is-on{ display:block; }

    @media (max-width: 980px){
      .topbar{ backdrop-filter:none; -webkit-backdrop-filter:none; }
      .pill, .glass, .meta-pill{
        backdrop-filter:none !important;
        -webkit-backdrop-filter:none !important;
      }
    }
    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto; }
      .interactive, .pill{ transition:none; }
      .progress > span{ transition:none; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <a class="brand" id="homeLink" href="#" aria-label="Vissza a f≈ëoldalra">
        <span class="dot"></span><span>Fitness Lady</span>
      </a>

      <nav class="nav" aria-label="Vev≈ë men√º">
        <a href="#program" data-nav>Programom</a>
        <a href="#etrend" data-nav>√âtrend</a>
        <a href="#checkin" data-nav>C√©lom & Check-in</a>
        <a href="#technika" data-nav>Technika</a>
      </nav>

      <div style="display:flex; align-items:center; gap:10px;">
        <button class="menu-btn" id="menuBtn" aria-label="Men√º">‚ò∞</button>
        <button class="pill ghost" id="btnLogout" type="button" title="Kijelentkez√©s">‚éã Kil√©p√©s</button>
      </div>
    </div>
  </header>

  <main>
    <div class="container page">
      <section id="top" class="glass interactive card" style="margin-bottom:14px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div>
            <div class="chip" id="chipPackage">Csomag: ‚Äî</div>
            <h2 style="margin-top:10px;" id="titleProgram">Saj√°t programom</h2>
            <p class="sub" id="subStatus">Bet√∂lt√©s‚Ä¶</p>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
            <button class="pill ghost" id="btnOpenSettings" type="button">Be√°ll√≠t√°sok</button>
          </div>
        </div>

        <div class="progress-label">
          <span id="lblWeek">H√©t: ‚Äî</span>
          <span id="lblDays">St√°tusz: ‚Äî</span>
        </div>
        <div class="progress" aria-label="Halad√°s">
          <span id="barCycle"></span>
        </div>

        <div class="meta-row">
          <div class="meta-pill" id="pillGoal">üéØ C√©l: ‚Äî</div>
          <div class="meta-pill" id="pillIntensity">‚ö° Szint: ‚Äî</div>
          <div class="meta-pill" id="pillUpdated">‚ú® Friss√≠t√©s: ‚Äî</div>
        </div>
      </section>

      <div class="grid">
        <section id="program" class="glass interactive card">
          <h3 id="hWorkouts">Heti edz√©sek</h3>
          <p class="sub" id="pWorkouts">Heti bont√°sban l√°tod az edz√©seidet. A szem√©lyre szab√°s slotokat Edina friss√≠ti.</p>

          <div class="tabs" id="weekTabs" aria-label="H√©t v√°laszt√≥"></div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin: 0 0 10px;">
            <button class="pill ghost tiny" id="btnMarkAll" type="button">‚úÖ Heti edz√©sek kipip√°l√°sa</button>
            <button class="pill ghost tiny" id="btnResetWeek" type="button">‚Ü∫ H√©t √∫jraind√≠t√°sa</button>
            <button class="pill ghost tiny" id="btnOpenPlayerHelp" type="button">‚ÑπÔ∏è Lej√°tsz√°s info</button>
          </div>

          <ul class="list" id="workoutList"></ul>

          <hr style="border:none; height:1px; background:rgba(255,255,255,.08); margin: 14px 0;" />

          <h3 id="hSlots">Szem√©lyre szab√°s</h3>
          <p class="sub" id="pSlots">A slotok csak a te programodhoz tartoz√≥ vide√≥kat mutatj√°k.</p>
          <ul class="list" id="slotList"></ul>
        </section>

        <div style="display:grid; gap:14px;">
          <section id="etrend" class="glass interactive card">
            <h3>√âtrend</h3>
            <p class="sub">A r√©szletes √©trend adminb√≥l √©rkezik. Amit Edina be√≠r, azt a rendszer automatikusan ‚Äúsz√©p‚Äù form√°ban mutatja.</p>

            <div class="row" style="grid-template-columns: 1fr; gap:8px;">
              <div>
                <div class="title">Mai f√≥kusz</div>
                <div class="desc">Egy dolog sz√°m√≠t: k√∂vetkezetess√©g. A l√©p√©sek maradnak.</div>
              </div>

              <div style="display:grid; gap:10px;">
                <!-- ‚úÖ csak a l√©p√©s marad -->
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <button class="pill ghost tiny" data-toggle="diet_steps" type="button">üëü 8‚Äì10k l√©p√©s</button>
                </div>

                <!-- ‚úÖ profibb render -->
                <div class="proText" id="dietContent">Bet√∂lt√©s‚Ä¶</div>
              </div>
            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
              <button class="pill ghost tiny" id="btnDietPlan" type="button">Napi terv</button>
            </div>
          </section>

          <section id="checkin" class="glass interactive card">
            <h3>C√©lom & Check-in</h3>
            <p class="sub">A check-in st√°tusz elment≈ëdik neked. K√©s≈ëbb admin is l√°tni fogja.</p>

            <div class="row" style="grid-template-columns: 1fr; gap:10px;">
              <div>
                <div class="title" id="goalTitle">üéØ C√©l: ‚Äî</div>
                <div class="desc" id="goalDesc">‚Äî</div>
              </div>

              <div style="display:grid; gap:8px;">
                <div class="progress-label" style="margin:0;">
                  <span>Heti check-in</span>
                  <span id="checkinLabel">0/1</span>
                </div>
                <div class="progress"><span id="barCheckin"></span></div>

                <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:4px;">
                  <button class="pill primary tiny" id="btnDoCheckin" type="button">Check-in k√©sz</button>
                  <button class="pill ghost tiny" id="btnMotivation" type="button">Motiv√°ci√≥</button>
                </div>

                <!-- ‚úÖ profibb render -->
                <div class="proText" id="motivationBox">Bet√∂lt√©s‚Ä¶</div>
              </div>
            </div>
          </section>
        </div>
      </div>

      <section id="technika" class="glass interactive card" style="margin-top:14px;">
        <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div>
            <h3>Technika Vault</h3>
            <p class="sub">Technika vide√≥k kateg√≥ri√°kban. (Admin kezeli.)</p>
          </div>
          <button class="pill ghost tiny" id="btnAddTechDone" type="button">‚úÖ Technik√°k kipip√°l√°sa</button>
        </div>

        <div class="tabs" id="techTabs" aria-label="Technika kateg√≥ri√°k"></div>
        <ul class="list" id="techList"></ul>
      </section>
    </div>
  </main>

  <footer>
    <div class="container footer-inner">
      <div>¬© <span id="y"></span> Fitness Lady</div>
      <div>T√ºske web design</div>
    </div>
  </footer>

  <!-- SETTINGS MODAL -->
  <div class="modal-overlay" id="settingsOverlay" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" aria-hidden="true">
    <div class="glass modal" role="document">
      <div class="modal-header">
        <h2 class="modal-title" id="settingsTitle">Be√°ll√≠t√°sok</h2>
        <button class="modal-close interactive" id="settingsClose" type="button" aria-label="Bez√°r√°s">‚úï</button>
      </div>
      <div class="modal-body">
        <p class="note">Itt csak a saj√°t c√©l/szint/nyelv m√≥dos√≠that√≥. Csomagot √©s szem√©lyre szab√°st admin √°ll√≠t.</p>

        <div class="field">
          <label for="setGoal">C√©l</label>
          <input id="setGoal" type="text" placeholder="pl. form√°l√°s / fogy√°s / er≈ë" />
        </div>

        <div class="field">
          <label for="setLevel">Szint (1‚Äì4)</label>
          <input id="setLevel" type="number" min="1" max="4" />
        </div>

        <div class="field">
          <label for="setLang">Nyelv (hu / de)</label>
          <input id="setLang" type="text" placeholder="hu" />
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="pill primary" id="btnSaveSettings" type="button">Ment√©s</button>
        </div>

        <p class="note" style="margin-top:10px;">
          Admin m√≥dos√≠t√°sok: az admin oldalon.
        </p>
      </div>
    </div>
  </div>

  <!-- INFO MODAL -->
  <div class="modal-overlay" id="infoOverlay" role="dialog" aria-modal="true" aria-labelledby="infoTitle" aria-hidden="true">
    <div class="glass modal" role="document">
      <div class="modal-header">
        <h2 class="modal-title" id="infoTitle">Info</h2>
        <button class="modal-close interactive" id="infoClose" type="button" aria-label="Bez√°r√°s">‚úï</button>
      </div>
      <div class="modal-body" id="infoBody"></div>
    </div>
  </div>

  <div class="debug" id="debugBox">debug</div>

  <script type="module">
    import {
      BASE_PREFIX, auth, db, fs,
      onAuth, logout, toLogin,
      escapeHtml, safeJsonParse, todayISO, clamp, fmtDate, daysBetween
    } from "../shared/firebase.js";

    // ‚úÖ home link marad HU
    const homeLink = document.getElementById("homeLink");
    if (homeLink) homeLink.href = `${BASE_PREFIX}/hu/`;

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function enableTapGlow(selector=".interactive"){
      $$(selector).forEach(el=>{
        el.addEventListener("touchstart", ()=>{
          el.classList.add("is-active");
          window.clearTimeout(el.__t);
          el.__t = window.setTimeout(()=>el.classList.remove("is-active"), 650);
        }, {passive:true});
      });
    }
    enableTapGlow();

    const debugOn = new URLSearchParams(location.search).get("debug") === "1";
    const debugBox = $("#debugBox");
    if(debugOn) debugBox.classList.add("is-on");
    const debug = (msg) => {
      if(!debugOn) return;
      debugBox.textContent = msg;
      console.log("[APP]", msg);
    };

    const settingsOverlay = $("#settingsOverlay");
    const infoOverlay = $("#infoOverlay");
    const infoBody = $("#infoBody");
    const infoTitle = $("#infoTitle");

    function openOverlay(overlay){
      overlay.classList.add("is-open");
      overlay.setAttribute("aria-hidden","false");
    }
    function closeOverlay(overlay){
      overlay.classList.remove("is-open");
      overlay.setAttribute("aria-hidden","true");
    }
    function openInfo(title, html){
      infoTitle.textContent = title;
      infoBody.innerHTML = html;
      openOverlay(infoOverlay);
    }

    $("#settingsClose").addEventListener("click", ()=>closeOverlay(settingsOverlay));
    $("#infoClose").addEventListener("click", ()=>closeOverlay(infoOverlay));
    settingsOverlay.addEventListener("click",(e)=>{ if(e.target===settingsOverlay) closeOverlay(settingsOverlay); });
    infoOverlay.addEventListener("click",(e)=>{ if(e.target===infoOverlay) closeOverlay(infoOverlay); });
    document.addEventListener("keydown",(e)=>{
      if(e.key==="Escape"){
        [settingsOverlay, infoOverlay].forEach(ov=>{
          if(ov.classList.contains("is-open")) closeOverlay(ov);
        });
      }
    });

    const menuBtn = $("#menuBtn");
    let menuOpen = false;
    function closeMobileNav(){ $("#mobileNav")?.remove(); menuOpen = false; }
    menuBtn?.addEventListener("click", ()=>{
      if(menuOpen){ closeMobileNav(); return; }
      closeMobileNav();
      menuOpen = true;
      const nav = document.createElement("div");
      nav.id = "mobileNav";
      nav.style.position = "fixed";
      nav.style.top = "64px";
      nav.style.left = "14px";
      nav.style.right = "14px";
      nav.style.zIndex = "60";
      nav.style.background = "rgba(20,12,26,.72)";
      nav.style.border = "1px solid rgba(255,255,255,.10)";
      nav.style.borderRadius = "18px";
      nav.style.backdropFilter = "blur(14px)";
      nav.style.boxShadow = "0 20px 70px rgba(0,0,0,.55)";
      nav.style.padding = "12px";
      nav.innerHTML = `
        <a href="#program" style="display:block; padding:10px 10px; color:rgba(255,255,255,.86)">Programom</a>
        <a href="#etrend" style="display:block; padding:10px 10px; color:rgba(255,255,255,.86)">√âtrend</a>
        <a href="#checkin" style="display:block; padding:10px 10px; color:rgba(255,255,255,.86)">C√©lom & Check-in</a>
        <a href="#technika" style="display:block; padding:10px 10px; color:rgba(255,255,255,.86)">Technika</a>
      `;
      document.body.appendChild(nav);
    });
    document.addEventListener("click",(e)=>{
      const nav = $("#mobileNav");
      if(!nav) return;
      if(e.target === menuBtn) return;
      if(nav.contains(e.target)) { closeMobileNav(); return; }
      closeMobileNav();
    });

    (()=> {
      const links = $$('[data-nav]');
      const sections = links.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
      const setActive = (id) => links.forEach(a => a.classList.toggle('is-active', a.getAttribute('href') === `#${id}`));
      const io = new IntersectionObserver((entries)=>{
        const visible = entries.filter(e=>e.isIntersecting).sort((a,b)=>b.intersectionRatio-a.intersectionRatio)[0];
        if(visible?.target?.id) setActive(visible.target.id);
      }, { threshold: [0.18, 0.28, 0.4] });
      sections.forEach(s=>io.observe(s));
    })();

    const k = (uid, key) => `fl_${uid}_${key}_v1`;
    const lsGet = (uid, key, fallback) => safeJsonParse(localStorage.getItem(k(uid,key)), fallback);
    const lsSet = (uid, key, value) => localStorage.setItem(k(uid,key), JSON.stringify(value));

    async function loadUserProfile(uid){
      const ref = fs.doc(db, "users", uid);
      const snap = await fs.getDoc(ref);
      if(!snap.exists()){
        const initial = {
          email: auth.currentUser?.email || "",
          displayName: "",
          lang: "hu",
          role: "user",
          status: "active",
          planId: "start_v1",
          goal: "Form√°l√°s",
          level: 2,
          lifetimeAccess: true,
          cycleStart: null,
          cycleEnd: null,

          dietText: "",
          motivationText: "",

          createdAt: fs.serverTimestamp(),
          updatedAt: fs.serverTimestamp()
        };
        await fs.setDoc(ref, initial, { merge: true });
        return initial;
      }
      return snap.data();
    }

    function defaultPlanMeta(planId){
      return { id: planId || "start_v1", name: { hu: "Start", de: "Start" }, weeks: 4 };
    }

    function defaultWeek(weekNo){
      return {
        workouts: [
          { id: "w1", title: {hu:`H√©t ${weekNo} ‚Ä¢ Edz√©s 1`, de:`Woche ${weekNo} ‚Ä¢ Workout 1`}, desc:{hu:"Tartalom felt√∂lt√©s alatt (admin).", de:"Inhalt wird geladen (Admin)."}, vimeoId:"" },
          { id: "w2", title: {hu:`H√©t ${weekNo} ‚Ä¢ Edz√©s 2`, de:`Woche ${weekNo} ‚Ä¢ Workout 2`}, desc:{hu:"Tartalom felt√∂lt√©s alatt (admin).", de:"Inhalt wird geladen (Admin)."}, vimeoId:"" },
          { id: "w3", title: {hu:`H√©t ${weekNo} ‚Ä¢ Edz√©s 3`, de:`Woche ${weekNo} ‚Ä¢ Workout 3`}, desc:{hu:"Tartalom felt√∂lt√©s alatt (admin).", de:"Inhalt wird geladen (Admin)."}, vimeoId:"" },
          { id: "w4", title: {hu:`H√©t ${weekNo} ‚Ä¢ Edz√©s 4`, de:`Woche ${weekNo} ‚Ä¢ Workout 4`}, desc:{hu:"Tartalom felt√∂lt√©s alatt (admin).", de:"Inhalt wird geladen (Admin)."}, vimeoId:"" }
        ],
        slots: [
          { slotIndex: 1, title:{hu:"Szem√©lyre szab√°s 1", de:"Personalisierung 1"}, desc:{hu:"Admin t√∂lti ki.", de:"Admin f√ºllt aus."}, defaultNote:{hu:"‚Äî", de:"‚Äî"}, defaultVimeoId:"" },
          { slotIndex: 2, title:{hu:"Szem√©lyre szab√°s 2", de:"Personalisierung 2"}, desc:{hu:"Admin t√∂lti ki.", de:"Admin f√ºllt aus."}, defaultNote:{hu:"‚Äî", de:"‚Äî"}, defaultVimeoId:"" },
          { slotIndex: 3, title:{hu:"Szem√©lyre szab√°s 3", de:"Personalisierung 3"}, desc:{hu:"Admin t√∂lti ki.", de:"Admin f√ºllt aus."}, defaultNote:{hu:"‚Äî", de:"‚Äî"}, defaultVimeoId:"" }
        ]
      };
    }

    async function loadPlanMeta(planId){
      try{
        const ref = fs.doc(db, "planTemplates", planId);
        const snap = await fs.getDoc(ref);
        if(!snap.exists()){
          openInfo("Program felt√∂lt√©s alatt", `
            <p class="note"><b>Nincs ilyen:</b> planTemplates/${escapeHtml(planId)}.</p>
            <p class="note">Adminban hozd l√©tre: <b>planTemplates/${escapeHtml(planId)}</b> + <b>weeks/1..N</b>.</p>
          `);
          return defaultPlanMeta(planId);
        }
        return snap.data();
      }catch(err){
        openInfo("Hiba", `<p class="note">Plan bet√∂lt√©s hiba: <code>${escapeHtml(err.message || String(err))}</code></p>`);
        return defaultPlanMeta(planId);
      }
    }

    async function loadPlanWeek(planId, weekNo){
      try{
        const ref = fs.doc(db, "planTemplates", planId, "weeks", String(weekNo));
        const snap = await fs.getDoc(ref);
        if(!snap.exists()) return defaultWeek(weekNo);
        return snap.data();
      }catch(_){
        return defaultWeek(weekNo);
      }
    }

    async function loadOverridesWeek(uid, weekNo){
      const tryPaths = [
        ["users", uid, "overridesWeeks", String(weekNo)],
        ["users", uid, "overrides", String(weekNo)],
      ];
      for(const segs of tryPaths){
        try{
          const ref = fs.doc(db, ...segs);
          const snap = await fs.getDoc(ref);
          if(snap.exists()) return snap.data();
        }catch(_){}
      }
      return null;
    }

    function pickLang(obj, lang, fallback="‚Äî"){
      if(!obj) return fallback;
      if(typeof obj === "string") return obj;
      if(obj[lang]) return obj[lang];
      if(obj["hu"]) return obj["hu"];
      if(obj["de"]) return obj["de"];
      return fallback;
    }

    function mergeWorkout(templateW, ovW, lang){
      const w = { ...templateW };
      if(ovW?.vimeoId) w.vimeoId = ovW.vimeoId;
      const tTitle = pickLang(templateW.title, lang, "");
      const oTitle = ovW?.title ? pickLang(ovW.title, lang, "") : "";
      w._title = oTitle || tTitle || "‚Äî";
      const tDesc = pickLang(templateW.desc, lang, "");
      const oDesc = ovW?.desc ? pickLang(ovW.desc, lang, "") : "";
      w._desc = oDesc || tDesc || "";
      return w;
    }

    function mergeSlot(templateS, ovS, lang){
      const s = { ...templateS };
      s.vimeoId = (ovS?.vimeoId) ? ovS.vimeoId : (templateS.defaultVimeoId || "");
      const tTitle = pickLang(templateS.title, lang, "");
      s._title = tTitle || "‚Äî";
      const tDesc = pickLang(templateS.desc, lang, "");
      s._desc = tDesc || "";
      const tNote = pickLang(templateS.defaultNote, lang, "‚Äî");
      const oNote = ovS?.note ? pickLang(ovS.note, lang, "") : "";
      s._note = oNote || tNote || "‚Äî";
      return s;
    }

    let UID = null;
    let profile = null;
    let planMeta = null;

    const weekCache = new Map();

    const state = {
      weekIdx: 0,
      done: {},
      diet: {},
      checkin: null,
      lang: "hu"
    };

    function calcWeekIndex(p){
      if(p?.lifetimeAccess || !p?.cycleStart || !p?.cycleEnd) return 0;
      const totalDays = Math.max(1, daysBetween(p.cycleStart, p.cycleEnd));
      const passedDays = clamp(daysBetween(p.cycleStart, todayISO()), 0, totalDays);
      const weeks = planMeta?.weeks ?? 4;
      const week = clamp(Math.floor((passedDays / totalDays) * weeks) + 1, 1, weeks);
      return week - 1;
    }

    function workoutKey(weekNo, id){ return `w${weekNo}_${id}`; }

    /* ‚úÖ PROFIBB SZ√ñVEG FORM√ÅZ√ì (admin sz√∂veg√©b≈ël) */
    function proFormatText(raw, {title=null, quote=false} = {}){
      const text = (raw || "").toString().replace(/\r\n/g,"\n").trim();
      if(!text){
        return "";
      }

      const lines = text.split("\n").map(l=>l.trim()).filter(Boolean);

      // ha van sok "Kulcs: √©rt√©k" sor -> kv blokkok
      const kvLines = lines.filter(l => /^[^:]{2,40}:\s+.+/.test(l));
      const kvMode = kvLines.length >= 2;

      const parts = [];
      if(title){
        parts.push(`<h4>${escapeHtml(title)}</h4>`);
      }

      if(quote){
        // motiv√°ci√≥: egy blokkban
        const safe = escapeHtml(text).replace(/\n/g, "<br>");
        parts.push(`<div class="quote">${safe}</div>`);
        return parts.join("");
      }

      if(kvMode){
        kvLines.forEach(l=>{
          const idx = l.indexOf(":");
          const k = l.slice(0, idx).trim();
          const v = l.slice(idx+1).trim();
          parts.push(`<div class="kv"><div class="k">${escapeHtml(k)}:</div><div class="v">${escapeHtml(v)}</div></div>`);
        });

        // marad√©k sorok (nem kv)
        const rest = lines.filter(l => !/^[^:]{2,40}:\s+.+/.test(l));
        if(rest.length){
          const blocks = [];
          let ul = [];
          rest.forEach(l=>{
            if(l.startsWith("- ") || l.startsWith("* ")){
              ul.push(l.slice(2).trim());
            }else{
              if(ul.length){
                blocks.push(`<ul>${ul.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>`);
                ul = [];
              }
              blocks.push(`<p>${escapeHtml(l)}</p>`);
            }
          });
          if(ul.length){
            blocks.push(`<ul>${ul.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>`);
          }
          parts.push(blocks.join(""));
        }

        return parts.join("");
      }

      // list mode felismer√©s
      const hasBullets = lines.some(l => l.startsWith("- ") || l.startsWith("* "));
      if(hasBullets){
        const blocks = [];
        let ul = [];
        lines.forEach(l=>{
          if(l.startsWith("- ") || l.startsWith("* ")){
            ul.push(l.slice(2).trim());
          }else{
            if(ul.length){
              blocks.push(`<ul>${ul.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>`);
              ul = [];
            }
            blocks.push(`<p>${escapeHtml(l)}</p>`);
          }
        });
        if(ul.length){
          blocks.push(`<ul>${ul.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>`);
        }
        parts.push(blocks.join(""));
        return parts.join("");
      }

      // sima bekezd√©sek
      parts.push(`<p>${escapeHtml(text).replace(/\n/g, "</p><p>")}</p>`);
      return parts.join("");
    }

    async function loadPlanWeekMerged(weekNo){
      if(weekCache.has(weekNo)) return weekCache.get(weekNo);

      const templateWeek = await loadPlanWeek(profile.planId, weekNo);
      const overridesWeek = await loadOverridesWeek(UID, weekNo);

      const ovWorkouts = overridesWeek?.workouts || {};
      const ovSlots = overridesWeek?.slots || {};

      const merged = {
        weekNo,
        workouts: (templateWeek.workouts || []).map(w => mergeWorkout(w, ovWorkouts[w.id], state.lang)),
        slots: (templateWeek.slots || []).map(s => mergeSlot(s, ovSlots[String(s.slotIndex)], state.lang))
      };

      const pack = { templateWeek, overridesWeek, merged };
      weekCache.set(weekNo, pack);
      return pack;
    }

    function renderHeader(){
      const p = profile;
      const planName = pickLang(planMeta?.name, state.lang, p.planId || "‚Äî");
      $("#chipPackage").textContent = `Csomag: ${planName}`;

      $("#pillGoal").textContent = `üéØ C√©l: ${p.goal || "‚Äî"}`;
      $("#pillIntensity").textContent = `‚ö° Szint: ${p.level ? `${p.level}/4` : "‚Äî"}`;
      $("#pillUpdated").textContent = `‚ú® Friss√≠t√©s: ‚Äî`;

      const weeks = planMeta?.weeks || 4;

      if(p.lifetimeAccess || !p.cycleStart || !p.cycleEnd){
        $("#lblWeek").textContent = `H√©t: ${state.weekIdx + 1}/${weeks}`;
        $("#lblDays").textContent = `St√°tusz: Akt√≠v (lej√°rat n√©lk√ºl)`;
        $("#barCycle").style.width = `100%`;
        $("#subStatus").textContent = `√údv, ${p.email || "!"} ‚Ä¢ A programod akt√≠v.`;
      }else{
        const totalDays = Math.max(1, daysBetween(p.cycleStart, p.cycleEnd));
        const passedDays = clamp(daysBetween(p.cycleStart, todayISO()), 0, totalDays);
        const leftDays = clamp(totalDays - passedDays, 0, totalDays);
        const week = clamp(Math.floor((passedDays / totalDays) * weeks) + 1, 1, weeks);

        $("#lblWeek").textContent = `H√©t: ${week}/${weeks}`;
        $("#lblDays").textContent = `H√°tral√©v≈ë napok: ${leftDays}`;
        const pct = Math.round((passedDays / totalDays) * 100);
        $("#barCycle").style.width = `${pct}%`;
        $("#subStatus").textContent = `Akt√≠v id≈ëszak: ${fmtDate(p.cycleStart)} ‚Äî ${fmtDate(p.cycleEnd)}`;
      }

      $("#goalTitle").textContent = `üéØ C√©l: ${p.goal || "‚Äî"}`;
      $("#goalDesc").textContent = p.goal
        ? `F√≥kusz: ${p.goal}. Heti check-in seg√≠t finomhangolni.`
        : `√Åll√≠ts be c√©lt, hogy a program jobban illeszkedjen.`;

      const done = state.checkin?.done ? 1 : 0;
      $("#checkinLabel").textContent = `${done}/1`;
      $("#barCheckin").style.width = `${done*100}%`;

      // ‚úÖ √âTREND (profibb)
      const dietText = (p.dietText || "").trim();
      $("#dietContent").innerHTML = dietText
        ? proFormatText(dietText, { title: "Mai terv" })
        : `<p class="note">M√©g nincs megadva r√©szletes √©trend. (Admin fogja felt√∂lteni.)</p>`;

      // ‚úÖ MOTIV√ÅCI√ì (profibb, quote)
      const mot = (p.motivationText || "").trim();
      $("#motivationBox").innerHTML = mot
        ? proFormatText(mot, { quote:true })
        : `<div class="quote">‚ÄûA rendszer nem nyom√°s. A rendszer szabads√°g.‚Äù</div>`;
    }

    function renderWeekTabs(){
      const weeks = planMeta.weeks || 4;
      const tabs = $("#weekTabs");
      tabs.innerHTML = "";
      for(let i=0;i<weeks;i++){
        const b = document.createElement("button");
        b.className = "tab" + (i===state.weekIdx ? " is-active" : "");
        b.type = "button";
        b.textContent = `H√©t ${i+1}`;
        b.addEventListener("click", async ()=>{
          state.weekIdx = i;
          await loadPlanWeekMerged(i+1);
          renderProgram();
          renderHeader();
        });
        tabs.appendChild(b);
      }
    }

    function renderProgram(){
      renderWeekTabs();

      const weekNo = state.weekIdx + 1;
      const pack = weekCache.get(weekNo);
      if(!pack){
        $("#workoutList").innerHTML = `<li class="row"><div><div class="title">Bet√∂lt√©s‚Ä¶</div><div class="desc">K√©rlek v√°rj.</div></div></li>`;
        $("#slotList").innerHTML = "";
        return;
      }

      const { merged } = pack;

      const ul = $("#workoutList");
      ul.innerHTML = "";
      merged.workouts.forEach(w=>{
        const key = workoutKey(weekNo, w.id);
        const done = !!state.done[key];

        const li = document.createElement("li");
        li.className = "row";
        li.innerHTML = `
          <div>
            <div class="title">${escapeHtml(w._title)} ${done ? ' <span class="chip" style="margin-left:6px;">‚úÖ k√©sz</span>' : ''}</div>
            <div class="desc">${escapeHtml(w._desc || "")}</div>
          </div>
          <div class="actions">
            <button class="pill ghost tiny" data-play="${escapeHtml(w.vimeoId || "")}">‚ñ∂ Lej√°tsz√°s</button>
            <button class="pill ${done ? 'danger' : 'primary'} tiny" data-toggle-done="${escapeHtml(key)}">${done ? 'Visszavon' : 'K√©sz'}</button>
          </div>
        `;
        ul.appendChild(li);
      });

      const sl = $("#slotList");
      sl.innerHTML = "";
      merged.slots.forEach((s)=>{
        const li = document.createElement("li");
        li.className = "row";
        li.innerHTML = `
          <div>
            <div class="title">${escapeHtml(s._title)}</div>
            <div class="desc">${escapeHtml(s._desc)}<br><span style="color:rgba(255,255,255,.72); font-size:12.6px;">Megjegyz√©s: ${escapeHtml(s._note)}</span></div>
          </div>
          <div class="actions">
            <button class="pill ghost tiny" data-play="${escapeHtml(s.vimeoId || "")}">‚ñ∂ Lej√°tsz√°s</button>
          </div>
        `;
        sl.appendChild(li);
      });

      $$("[data-play]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const vimeoId = b.getAttribute("data-play");
          if(!vimeoId){
            openInfo("Lej√°tsz√°s", `<p class="note">Ehhez m√©g nincs Vimeo ID be√°ll√≠tva (admin).</p>`);
            return;
          }
          const src = `https://player.vimeo.com/video/${encodeURIComponent(vimeoId)}`;
          openInfo("Lej√°tsz√°s", `
            <p class="note">Ha a vide√≥ nem indul: Vimeo embed whitelist (fitnesslady.ch) ellen≈ërz√©s.</p>
            <div style="border:1px solid rgba(255,255,255,.12); border-radius:18px; overflow:hidden; background:rgba(0,0,0,.25)">
              <iframe
                src="${escapeHtml(src)}"
                width="100%" height="480"
                frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture"
                allowfullscreen
                style="display:block">
              </iframe>
            </div>
          `);
        });
      });

      $$("[data-toggle-done]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const key = b.getAttribute("data-toggle-done");
          state.done[key] = !state.done[key];
          lsSet(UID, "done", state.done);
          renderProgram();
        });
      });
    }

    function renderTechnika(){
      const tabs = $("#techTabs");
      const list = $("#techList");
      tabs.innerHTML = "";
      list.innerHTML = `
        <li class="row">
          <div>
            <div class="title">Technika Vault</div>
            <div class="desc">A technika vide√≥k adminb√≥l j√∂nnek. K√∂vetkez≈ë l√©p√©s: kateg√≥ri√°k + vide√≥k.</div>
          </div>
          <div class="actions">
            <button class="pill ghost tiny" type="button" id="btnTechInfo">‚ÑπÔ∏è</button>
          </div>
        </li>
      `;
      $("#btnTechInfo")?.addEventListener("click", ()=>{
        openInfo("Technika Vault", `<p class="note">K√∂vetkez≈ë k√∂r: technika kateg√≥ri√°k admin szerkeszt√©ssel.</p>`);
      });
    }

    function refreshDietButtons(){
      const d = state.diet;
      $$("[data-toggle]").forEach(btn=>{
        const key = btn.getAttribute("data-toggle");
        const on = !!d[key];
        btn.classList.toggle("primary", on);
        btn.classList.toggle("ghost", !on);
      });
    }

    function renderAll(){
      renderHeader();
      renderProgram();
      renderTechnika();
      refreshDietButtons();
      enableTapGlow();
    }

    $("#btnLogout").addEventListener("click", async ()=>{
      await logout();
      toLogin(state.lang || "hu");
    });

    $("#btnMarkAll").addEventListener("click", ()=>{
      const weekNo = state.weekIdx + 1;
      const pack = weekCache.get(weekNo);
      if(!pack) return;
      pack.merged.workouts.forEach(w => state.done[workoutKey(weekNo, w.id)] = true);
      lsSet(UID, "done", state.done);
      renderProgram();
    });

    $("#btnResetWeek").addEventListener("click", ()=>{
      const weekNo = state.weekIdx + 1;
      const pack = weekCache.get(weekNo);
      if(!pack) return;
      pack.merged.workouts.forEach(w => delete state.done[workoutKey(weekNo, w.id)]);
      lsSet(UID, "done", state.done);
      renderProgram();
    });

    $("#btnOpenPlayerHelp").addEventListener("click", ()=>{
      openInfo("Vimeo be√°gyaz√°s (√©les)", `
        <p class="note"><b>√âles</b> be√°ll√≠t√°s: Vimeo embed whitelist: <b>fitnesslady.ch</b></p>
        <ul style="color:rgba(255,255,255,.78); line-height:1.65; font-size:13.5px;">
          <li>Hide from Vimeo / Private</li>
          <li>Embed whitelist: fitnesslady.ch</li>
          <li>Download: OFF</li>
        </ul>
      `);
    });

    // ‚úÖ csak a l√©p√©s toggle maradt
    $$("[data-toggle]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const key = btn.getAttribute("data-toggle");
        state.diet[key] = !state.diet[key];
        lsSet(UID, "diet", state.diet);
        refreshDietButtons();
      });
    });

    $("#btnDietPlan").addEventListener("click", ()=>{
      const txt = (profile?.dietText || "").trim();
      openInfo("Napi terv", txt
        ? `<div class="proText">${proFormatText(txt, { title: "Mai terv" })}</div>`
        : `<p class="note">M√©g nincs be√°ll√≠tott r√©szletes √©trend. (Admin fogja felt√∂lteni.)</p>`
      );
    });

    const MOTS = [
      "‚ÄûA rendszer nem nyom√°s. A rendszer szabads√°g.‚Äù",
      "‚ÄûA halad√°s nem t√∂k√©letess√©g. Hanem k√∂vetkezetess√©g.‚Äù",
      "‚ÄûNem csak form√°t √©p√≠tesz ‚Äì bizalmat √©s j√∂v≈ët.‚Äù",
      "‚ÄûAmit ma megteszel, az a holnapi √∂nbizalmad.‚Äù"
    ];
    $("#btnMotivation").addEventListener("click", ()=>{
      const m = (profile?.motivationText || "").trim();
      if(m){
        $("#motivationBox").innerHTML = proFormatText(m, { quote:true });
        return;
      }
      $("#motivationBox").innerHTML = `<div class="quote">${escapeHtml(MOTS[Math.floor(Math.random()*MOTS.length)])}</div>`;
    });

    $("#btnDoCheckin").addEventListener("click", ()=>{
      state.checkin = { done: true, at: new Date().toISOString() };
      lsSet(UID, "checkin", state.checkin);
      renderHeader();
      openInfo("Check-in", `<p class="note">K√©sz ‚úÖ (elmentve neked).</p>`);
    });

    $("#btnOpenSettings").addEventListener("click", ()=>{
      $("#setGoal").value = profile.goal || "";
      $("#setLevel").value = profile.level || 2;
      $("#setLang").value = profile.lang || "hu";
      openOverlay(settingsOverlay);
    });

    $("#btnSaveSettings").addEventListener("click", async ()=>{
      const goal = ($("#setGoal").value || "").trim();
      const level = clamp(parseInt($("#setLevel").value || "2", 10), 1, 4);
      const lang = (($("#setLang").value || "hu").trim().toLowerCase() === "de") ? "de" : "hu";

      await fs.setDoc(fs.doc(db, "users", UID), {
        goal,
        level,
        lang,
        updatedAt: fs.serverTimestamp()
      }, { merge:true });

      profile.goal = goal;
      profile.level = level;
      profile.lang = lang;
      state.lang = lang;

      weekCache.clear();
      await loadPlanWeekMerged(state.weekIdx + 1);

      closeOverlay(settingsOverlay);
      renderAll();
    });

    document.getElementById("y").textContent = new Date().getFullYear();

    onAuth(async (user)=>{
      try{
        if(!user){
          toLogin("hu");
          return;
        }
        UID = user.uid;

        state.done = lsGet(UID, "done", {});
        state.diet = lsGet(UID, "diet", {});
        state.checkin = lsGet(UID, "checkin", null);

        profile = await loadUserProfile(UID);
        state.lang = (profile.lang === "de") ? "de" : "hu";

        planMeta = await loadPlanMeta(profile.planId);
        state.weekIdx = calcWeekIndex(profile);

        await loadPlanWeekMerged(state.weekIdx + 1);

        renderAll();
        debug(`OK uid=${UID} plan=${profile.planId} lang=${state.lang}`);

      }catch(err){
        console.error(err);
        openInfo("Hiba", `
          <p class="note">Hiba t√∂rt√©nt bet√∂lt√©s k√∂zben.</p>
          <div class="row" style="grid-template-columns: 1fr;">
            <div class="title">R√©szletek</div>
            <div class="desc"><code style="white-space:pre-wrap; word-break:break-word;">${escapeHtml(err.message || String(err))}</code></div>
          </div>
        `);
      }
    });
  </script>
</body>
  </html>
