<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitnessLady – Bejelentkezés</title>
  <meta name="description" content="FitnessLady – Bejelentkezés és regisztráció" />

  <style>
    :root{
      --bg:#07060b;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.70);
      --muted2:rgba(255,255,255,.55);

      --pink:#ff4fd8;
      --pink2:#b14cff;

      --radius:22px;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --max: 520px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 30% 10%, rgba(255,79,216,.16), transparent 60%),
        radial-gradient(1000px 700px at 75% 20%, rgba(177,76,255,.14), transparent 60%),
        radial-gradient(1000px 700px at 60% 90%, rgba(255,211,138,.06), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    /* hero.png full-page háttér */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -1;
      background-image: url("/hero.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      will-change: transform;
      transform: translate3d(0,0,0);
      backface-visibility: hidden;
    }

    /* topbar (mini) */
    .topbar{
      position: sticky;
      top:0;
      z-index: 50;
      background: rgba(8,6,12,.70);
      border-bottom: 1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .topbar-inner{
      width: min(1180px, 92vw);
      margin: 0 auto;
      height: 64px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      letter-spacing:.2px;
      white-space: nowrap;
      text-decoration:none;
      color:var(--text);
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ffd0f6, var(--pink));
      box-shadow: 0 0 18px rgba(255,79,216,.7);
      flex: 0 0 auto;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.12);
      text-decoration:none;
      font-weight: 900;
      white-space: nowrap;
    }

    /* wrap */
    .wrap{
      width: min(var(--max), 92vw);
      margin: 0 auto;
      padding: 26px 0 60px;
      min-height: calc(100vh - 64px);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* glass card */
    .glass{
      width: 100%;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      position: relative;
      overflow:hidden;
    }

    .glass::before{
      content:"";
      position:absolute; inset:-3px;
      border-radius: inherit;
      background:
        radial-gradient(700px 240px at 12% 0%, rgba(255,79,216,.32), transparent 55%),
        radial-gradient(700px 260px at 90% 20%, rgba(177,76,255,.26), transparent 60%);
      opacity: .55;
      filter: blur(10px);
      pointer-events:none;
    }

    .card{
      position: relative;
      padding: 18px;
    }

    h1{
      margin: 0 0 6px;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      font-size: 26px;
      letter-spacing: -.4px;
    }
    .sub{
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 13.5px;
      line-height: 1.6;
    }

    label{
      display:block;
      font-size: 12.8px;
      color: var(--muted);
      margin: 12px 0 6px;
      font-weight: 750;
      letter-spacing: .15px;
    }
    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,8,14,.55);
      color: var(--text);
      outline:none;
      transition: border-color .18s ease, background .18s ease, transform .18s ease;
    }
    input:focus{
      border-color: rgba(255,79,216,.38);
      background: rgba(10,8,14,.68);
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    button{
      flex:1;
      min-width: 150px;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      cursor:pointer;
      font-weight: 900;
      color: var(--text);
      background: rgba(20,12,26,.55);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      user-select:none;
    }
    button:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.20);
    }

    .primary{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:#140813;
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 18px 46px rgba(255,79,216,.26);
    }
    .ghost{
      background: rgba(255,255,255,.06);
      color: var(--text);
    }

    .small{
      font-size: 12.5px;
      color: var(--muted2);
      margin-top: 12px;
      line-height: 1.5;
    }

    .log{
      margin-top: 14px;
      white-space: pre-wrap;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      background: rgba(10,8,14,.55);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 12px;
      min-height: 74px;
      color: rgba(255,255,255,.88);
    }

    .hint{
      margin-top: 10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content: space-between;
      color: var(--muted2);
      font-size: 12.5px;
    }
    .link{
      color: rgba(255,255,255,.88);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    @media (prefers-reduced-motion: reduce){
      button, input{ transition:none; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="/hu/" aria-label="Fitness Lady">
        <span class="dot"></span>
        <span>Fitness Lady</span>
      </a>
      <a class="pill" href="/hu/">Vissza a főoldalra</a>
    </div>
  </header>

  <div class="wrap">
    <div class="glass">
      <div class="card">
        <h1>Bejelentkezés / Regisztráció</h1>
        <p class="sub">Belépés vagy regisztráció után automatikusan a <b>vevő oldalra</b> viszünk.</p>

        <label>Email</label>
        <input id="email" type="email" placeholder="pl. teszt@fitnesslady.ch" autocomplete="email">

        <label>Jelszó</label>
        <input id="pass" type="password" placeholder="min. 6 karakter" autocomplete="current-password">

        <div class="row">
          <button class="primary" id="btnLogin" type="button">Belépés</button>
          <button class="ghost" id="btnRegister" type="button">Regisztráció</button>
        </div>

        <div class="row">
          <button class="ghost" id="btnMe" type="button">Profil lekérés</button>
          <button class="ghost" id="btnLogout" type="button">Kilépés</button>
        </div>

        <div class="hint">
          <span>Ha már be vagy lépve: automatikusan átdobunk az appba.</span>
          <a class="link" href="/hu/app/">Vevő oldal megnyitása</a>
        </div>

        <div class="log" id="log">Log: betöltés…</div>

        <div class="small">
          Tipp: ha “nem dob át”, csinálj egy hard refresh-t: <b>Ctrl+F5</b> (Windows) / <b>Cmd+Shift+R</b> (Mac).
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBl2MzyiRzgCzeg-eEWNHkc9Vxx-PgawfU",
      authDomain: "fitneady-15fd0.firebaseapp.com",
      projectId: "fitneady-15fd0",
      storageBucket: "fitneady-15fd0.firebasestorage.app",
      messagingSenderId: "480597492603",
      appId: "1:480597492603:web:2ba6c266c662b4c79e33de",
      measurementId: "G-MH1YK9C2YF"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch (e) {}
    const auth = getAuth(app);
    const db = getFirestore(app);

    const REDIRECT_AFTER_AUTH = "/hu/app/";

    const $ = (id) => document.getElementById(id);
    const log = (msg) => { $("log").textContent = "Log: " + msg; console.log(msg); };

    function getInputs() {
      const email = $("email").value.trim();
      const password = $("pass").value;
      return { email, password };
    }

    // Regisztráció
    async function doRegister() {
      const { email, password } = getInputs();
      if (!email || password.length < 6) return log("Hiba: email kell + jelszó min. 6 karakter.");
      log("Regisztráció indul…");

      const cred = await createUserWithEmailAndPassword(auth, email, password);

      // User doc mentése (ehhez Firestore Rules kell)
      await setDoc(doc(db, "users", cred.user.uid), {
        email: cred.user.email,
        package: "Start",
        goal: "Formálás",
        level: 2,
        active: true,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      }, { merge: true });

      log("Sikeres regisztráció ✅ Átirányítás az appba…");
      window.location.href = REDIRECT_AFTER_AUTH;
    }

    // Belépés
    async function doLogin() {
      const { email, password } = getInputs();
      if (!email || !password) return log("Hiba: add meg az emailt és jelszót.");
      log("Belépés…");

      const cred = await signInWithEmailAndPassword(auth, email, password);

      log("Belépve ✅ " + cred.user.email + " → átirányítás…");
      window.location.href = REDIRECT_AFTER_AUTH;
    }

    // Kilépés
    async function doLogout() {
      await signOut(auth);
      log("Kijelentkezve.");
    }

    // Profil lekérés
    async function doMe() {
      const user = auth.currentUser;
      if (!user) return log("Nincs belépve user.");
      const snap = await getDoc(doc(db, "users", user.uid));
      log("Profil: " + (snap.exists() ? JSON.stringify(snap.data(), null, 2) : "nincs users/" + user.uid));
    }

    $("btnRegister").addEventListener("click", () => doRegister().catch(e => log("Reg hiba: " + e.message)));
    $("btnLogin").addEventListener("click", () => doLogin().catch(e => log("Login hiba: " + e.message)));
    $("btnLogout").addEventListener("click", () => doLogout().catch(e => log("Logout hiba: " + e.message)));
    $("btnMe").addEventListener("click", () => doMe().catch(e => log("Me hiba: " + e.message)));

    // Ha már be van lépve, ne álljon itt → dobjuk át az appba
    onAuthStateChanged(auth, (user) => {
      if (user) {
        log("Auth state: LOGGED IN → " + user.email + " (redirect…)");

        // rövid delay, hogy a log látszódjon 1 pillanatra (nem kötelező)
        setTimeout(() => {
          window.location.href = REDIRECT_AFTER_AUTH;
        }, 250);
      } else {
        log("Auth state: LOGGED OUT");
      }
    });
  </script>
</body>
</html>
