<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fiók aktiválása</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#0b0b12;color:#fff}
    .wrap{max-width:520px;margin:40px auto;padding:24px}
    .card{background:#151526;border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:22px}
    label{display:block;margin:14px 0 6px;opacity:.9}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f0f1c;color:#fff}
    button{width:100%;margin-top:16px;padding:12px 14px;border:0;border-radius:14px;background:linear-gradient(90deg,#ff4fd8,#6d5bff);color:#fff;font-weight:700;cursor:pointer}
    .msg{margin-top:12px;color:#ff7b7b;min-height:20px}
    .ok{color:#7bffb0}
    a{color:#9ad1ff}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Fiók aktiválása</h2>
      <p>Állíts be egy jelszót, és utána be tudsz lépni.</p>

      <label>Új jelszó (min. 8 karakter)</label>
      <input id="p1" type="password" minlength="8" />

      <label>Jelszó ismét</label>
      <input id="p2" type="password" minlength="8" />

      <button id="btn">Jelszó beállítása</button>
      <div id="msg" class="msg"></div>
      <div style="margin-top:10px;opacity:.9">
        Ha kész: <a href="/hu/login/">Belépés</a>
      </div>
    </div>
  </div>

<script>
  // ✅ IDE tedd be a saját Apps Script Web App /exec URL-ed:
  const API_URL = "PASTE_YOUR_SCRIPT_EXEC_URL_HERE";

  const qs = new URLSearchParams(location.search);
  const token = qs.get("t"); // register_link .../hu/register/?t=XXXX

  const msgEl = document.getElementById("msg");
  const btn = document.getElementById("btn");

  function setMsg(text, ok=false){
    msgEl.textContent = text || "";
    msgEl.className = "msg" + (ok ? " ok" : "");
  }

  btn.addEventListener("click", async () => {
    setMsg("");

    if(!token){ setMsg("Hiányzik a token a linkből (t=...)."); return; }

    const p1 = document.getElementById("p1").value;
    const p2 = document.getElementById("p2").value;

    if(p1.length < 8){ setMsg("A jelszó legyen legalább 8 karakter."); return; }
    if(p1 !== p2){ setMsg("A két jelszó nem egyezik."); return; }

    btn.disabled = true;
    btn.textContent = "Mentés...";

    try{
      // ✅ CORS workaround: text/plain + JSON string body
      const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type":"text/plain;charset=utf-8"},
        body: JSON.stringify({
          action: "authSetPassword",
          reg_token: token,
          new_password: p1
        })
      });

      const data = await res.json();

      if(!data.ok){
        setMsg("Hiba: " + (data.error || "UNKNOWN"));
      }else{
        setMsg("Kész! Jelszó beállítva. Mehetsz belépni.", true);
        // opcionális: automatikus átdobás
        // location.href = "/hu/login/";
      }
    }catch(e){
      setMsg("Hálózati hiba: " + e.message);
    }finally{
      btn.disabled = false;
      btn.textContent = "Jelszó beállítása";
    }
  });
</script>
</body>
</html>
